
.thumb
.syntax unified

.include "gpio_constants.s"     // Register-adresser og konstanter for GPIO

.text
	.global Start
	
Start:

	// SETTER R0 SOM DIN ADDRESSE

	LDR R0, =BUTTON_PORT
	LDR R1, =PORT_SIZE
	MUL R0, R0, R1
	LDR R1, =GPIO_BASE
	ADD R0, R0, R1
	LDR R1, =GPIO_PORT_DIN
	ADD R0, R0, R1

	// SETTER R3 SOM DOUTSET ADDRESSE OG R4 SOM DOUTCLR ADDRESSE

	LDR R2, =LED_PORT
	LDR R3, =PORT_SIZE
	MUL R2, R2, R3
	LDR R3, =GPIO_BASE
	ADD R2, R2, R3
	LDR R3, =GPIO_PORT_DOUTSET
	ADD R3, R2, R3
	LDR R4, =GPIO_PORT_DOUTCLR
	ADD R4, R2, R4

	// SETTER R1 OG R2 TIL Ã… FJERNE UINTERESSANTE BITS I HENHOLDVIS DIN OG DOUT REGISTRENE

	MOV R1, #1
	LSL R1, R1, #BUTTON_PIN

	MOV R2, #1
	LSL R2, R2, #LED_PIN

	// STARTER I TILSTANDEN LED AV.
	B CLR_LED

	SET_LED:
		STR R2, [R3]
	CHECK_BUTTON_OFF:
		LDR R5, [R0]
		AND R5, R5, R1
		CMP R5, #0
		BNE CLR_LED
		B CHECK_BUTTON_OFF
	CLR_LED:
		STR R2, [R4]
	CHECK_BUTTON_ON:
		LDR R5, [R0]
		AND R5, R5, R1
		CMP R5, #0
		BEQ SET_LED
		B CHECK_BUTTON_ON

NOP

